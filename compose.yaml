# ============================================================
# Base / shared configuration â€” included by dev AND prod
# ============================================================
services:
  # ---- Main Backend (Flask) ----
  backend:
    build:
      context: ./backend
    environment:
      - SEPARATOR_URL=http://auto-separator:5000
      - PYTHONUNBUFFERED=1
    depends_on:
      - auto-separator
    # Give the backend enough time to finish an in-flight request on shutdown
    stop_grace_period: 1860s

  # ---- Audio Separator (Flask + ML) ----
  auto-separator:
    build:
      context: ./auto-seperator
    environment:
      - PYTHONUNBUFFERED=1
    # don't SIGKILL during shutdown
    stop_grace_period: 1860s
